{"name":"Yamm","tagline":"Yet Another Matlab MCMC code","body":"# yamm\r\n## Yet Another Matlab MCMC code\r\n\r\nHere is another Matlab (and potentially Octave compatible) code for performing Markov chain Monte Carlo parameter estimation. Other MCMC codes are available.\r\n\r\nThe code can use a variety of proposal functions including the \"stretch\" and \"walk\" affine invariant ensemble samplers of [Goodman & Weare](http://msp.org/camcos/2010/5-1/p04.xhtml). It also allows a variety of prior functions (or a user defined function) for the parameters.\r\n\r\n## Setup\r\n\r\nYou can use the code by simply adding the ``src`` directory to your Matlab path, e.g. in ``bash`` in Linux just type\r\n\r\n    export MATLABPATH=${MATLABPATH}:path_to_repository/src\r\n\r\nAlternatively run the provided ``setup.py`` script with\r\n\r\n    . ./setup.sh\r\n    \r\nto add the paths to ``MATLABPATH``, or use the ``addpath`` command in Matlab, or just do it through the window options.\r\n\r\nIf trying this with Octave just set the ``OCTAVEPATH`` environment variable instead, or again use the ``addpath`` command.\r\n\r\n## Example\r\n\r\nHere I'll give a couple of examples (well one at the moment) of setting up the likelihood and model functions and the parameters for estimation. The style of the likelihood and model functions given here are how they should be set up in general. Other examples are given in the ``Examples`` directory.\r\n\r\n### Sinusoid example\r\n\r\nAn example of running the code for a sinusoidal model and Gaussian likelihood is given here. First let's define the model function. Note that the model function should take three variables:\r\n 1. a variable, in this case ``t`` (a vector of time stamps), that could be a single value, vector, or matrix, giving the points at which the model is evaluated;\r\n 2. a cell array (``parnames``) containing the names of any variables needed to define the model, where the names are recognised by the ``switch`` statement in the function;\r\n 3. a cell array (``parvals``) containing the values of each of the variables in ``parnames``, which much be included in the same order. These variables can be anything - floats, integers, strings, vectors, matrices - as long as the model function knows what to do with them. However, any variables that are being estimated must just be individual real numbers.\r\n\r\n```matlab\r\nfunction y = sinusoid_model(t, parnames, parvals)\r\n\r\n% check that parnames and parvals have the same length\r\nlpn = length(parnames);\r\nlpv = length(parvals);\r\nif lpn ~= lpv\r\n    error('Error: parnames and parvals are not the same length!');\r\nend\r\n\r\n% extract parameter values\r\nfor i=1:lpn\r\n    switch parnames{i}\r\n        case 'amp' % sinusoid amplitude\r\n            amp = parvals{i};\r\n        case 't0' % the phase epoch\r\n            t0 = parvals{i}\r\n        case 'phi0' % sinusoid initial phase at t0\r\n            phi0 = parvals{i};\r\n        case 'freq' % sinusoid frequency (Hz)\r\n            freq = parvals{i};\r\n    end\r\nend\r\n\r\n% generate the sinusoid at the values t\r\ny = amp * sin(2*pi*freq*(t-t0) + phi0);\r\n\r\n```\r\n\r\nNow let's define the log likelihood function, which we'll take as a Gaussian with a stationary noise variance. Note that the log likelihood function should take in four variables:\r\n 1. a ``data`` variable containing any 'data' information. In this case ``data`` is a cell array with the first cell containing a vector of time stamps of the data samples, the second cell containing the actual data samples, and the third cell containing the data variance, but data could contain any other information required by the likelihood function, provided the likelihood function knows what to do with it;\r\n 2. a ``model`` function (either a function handle or function name string) e.g. the ``sinusoid_model`` above;\r\n 3. a cell array ``parnames`` containing the model parameter names to be passed to the model (as above);\r\n 4. a cell array ``parvals`` containing the model parameter values to be passed to the model (as above).\r\n\r\n```matlab\r\nfunction logL = logL_gaussian(data, model, parnames, parvals)\r\n\r\n% check whether model is a string or function handle\r\nif ischar(model)\r\n    fmodel = str2func(model);\r\nelseif isa(model, 'function_handle')\r\n    fmodel = model;\r\nelse\r\n    error('Error... Expecting a model function!');\r\nend\r\n\r\n% get the data from the data cell array\r\nt = data{1}; % vector of time stamps at which the data is given\r\ny = data{2}; % vector of data (e.g. noise + signal)\r\nC = data{3}; % the value of the noise variance\r\n\r\nN = length(t);\r\ninvC = 1/C;\r\nlDetC = N*log(C);\r\n\r\n% evaluate the model\r\nmd = feval(fmodel, x, parnames, parvals);\r\n\r\n% if the model returns a NaN then set the likelihood to be zero (e.g. loglikelihood to be -inf)\r\nif isnan(md)\r\n    logL = -inf;\r\n    return;\r\nend\r\n\r\n% calculate the log likelihood\r\nlogL = -0.5*(y - md)' * invC * (y - md);\r\nlogL = logL - 0.5*N*log(2*pi) - 0.5*lDetC;\r\n\r\nif isnan(logL)\r\n    error('Error: log likelihood is NaN!');\r\nend\r\n\r\nreturn\r\n\r\n```\r\n\r\nNow let's create a script that creates some simulated data (a sinusoid added to Gaussian noise) and then uses the MCMC to extract the posteriors of two of the sinusoid parameters (the amplitude and the phase) assuming the frequency and phase epoch are known.\r\n```matlab\r\n% SIMULATE DATA\r\n% discrete times\r\ndt = 1/5; % sampling rate of signal (Hz)\r\ntlen = 6; % length of signal (seconds)\r\nt = (0:dt:(tlen-dt))';\r\n\r\n% inject a simulated sinusoidal signal model\r\namp = 10.0; % signal amplitude\r\nphi0 = 2.3; % initial phase of signal (rads)\r\nf0 = 0.788634; % signal frequency\r\nt0 = 0; % phase epoch\r\n\r\n% create signal injection\r\ns = sinusoid_model(t, {'amp', 'phi0', 't0', 'freq'}, {amp, phi0, t0, freq});\r\n\r\n% gaussian noise model (white)\r\nsigma2 = 16; % variance of Gaussian noise\r\nn = sqrt(sigma2) * randn(length(t), 1);\r\n\r\n% data (t, y, covariance matrix)\r\ny = s+n; % signal + noise\r\ndata{1} = t;\r\ndata{2} = y;\r\ndata{3} = sigma2;\r\n\r\n%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\r\n% define nested sampling parameters\r\nNmcmc = 50000; % MCMC samples\r\nNburnin = 50000; % burn in\r\n\r\nlikelihood = @logL_gaussian;\r\nmodel = @sinusoid_model;\r\n\r\n% setup the prior (THIS IS IMPORTANT)\r\n% we want to estimate the 'amp' and 'phi0' parameters, so these go in a prior variable\r\n% that defines the type of prior and range of the prior - in this case uniform priors\r\n% over a given minimum and maximum range\r\nprior = {'amp', 'uniform', 0, 20, 'fixed'; ...\r\n         'phi0', 'uniform', 0, 2*pi, 'cyclic'};\r\n         \r\n% we need to define the other parameters needed for the model in the extraparams \r\n% cell array variable\r\nextraparams = {'freq', freq; ...\r\n               't0', t0};\r\n\r\n% RUN THE MCMC (using the ensemble sampler with 10 'walkers')\r\n[post_samples, logP] = mcmc_sampler(data, likelihood, model, prior, ...\r\n    extraparams, 'Nmcmc', Nmcmc, 'Nburnin', Nburnin, ...\r\n    'NensembleStretch', 10);\r\n\r\n```\r\n\r\n## Alternatives\r\n\r\nFor Matlab code doing a very similar job see e.g. [The MCMC Hammer](http://www.mathworks.com/matlabcentral/fileexchange/49537-the-mcmc-hammer---affine-invariant-mcmc-sampler) by Aslak Grinsted, the [MCMC toolbox for Matlab](http://helios.fmi.fi/~lainema/mcmc/) by Marko Laine, or look elsewhere on the [Matlab File Exchange](http://www.mathworks.com/matlabcentral/fileexchange/) or [Google](https://www.google.co.uk/#q=matlab+mcmc)! Or, alternatively if you're more into Python (as I am too!) check out [emcee](http://dan.iel.fm/emcee/current/) (as described in Forman-Mackay et al., [arXiv:1202.3665](http://arxiv.org/abs/1202.3665)).\r\n\r\nFor similar Matlab-based Bayesian parameter estimation and evidence evaluation you may also want to checkout the [Matlab implementation of MultiNest](http://ccpforge.cse.rl.ac.uk/gf/project/multinest/frs/).\r\n\r\n&copy; Matthew Pitkin, 2015\r\n\r\n","google":"UA-10008049-6","note":"Don't delete this file! It's used internally to help with page regeneration."}